{% extends "base/main.html" %}
{% block title %}Profile - CashPop{% endblock title %}

{% block content %}

<!-- Profile Content -->
<main class="profile">
  <div class="container">
    <h1 class="page-title">My Profile</h1>
    
    <div class="profile-container">
      <div class="profile-sidebar">
        <div class="profile-card">
          {% comment %} <div class="profile-avatar large">
            <span>U</span>
          </div> {% endcomment %}
          <h2 class="profile-name">{{request.user.first_name.capitalize}}</h2>
          <p class="profile-email">{{request.user.username}}</p>
          <p class="profile-member-since">{{request.user.userprofile.date_joined | timesince}}</p>
          <div class="profile-level">
            <p>Level 3 Earner</p>
            <div class="progress-bar">
              <div class="progress" style="width: 65%;"></div>
            </div>
            <p class="progress-text">65/100 XP to Level 4</p>
          </div>
        </div>
        
        <div class="profile-stats">
          <div class="profile-stat-item">
            <h3>Total Earned</h3>
            <p>&#8358;{{request.user.userprofile.balance}}</p>
          </div>
          <div class="profile-stat-item">
            <h3>Tasks Completed</h3>
            <p>{{request.user.userprofile.total_task_completed}}</p>
          </div>
          <div class="profile-stat-item">
            <h3>Current Streak</h3>
            <p>{{request.user.userprofile.streak}} days</p>
          </div>
        </div>
        
        <div class="profile-actions">
          <button class="btn btn-outline btn-block">Edit Profile</button>
          <button class="btn btn-primary btn-block">Withdraw Funds</button>
        </div>
      </div>
      
      <div class="profile-main">
        <div class="profile-tabs">
          <a class="profile-tab" href="{% url "base:profile" %}">Task History</a>
          <a class="profile-tab" href="{% url "base:payment-history" %}">Payment History</a>
          <a class="profile-tab" href="{% url "base:account" %}">Account Settings</a>
        </div>
        
        <div class="profile-tab-content active" id="history">
          <h2>Recent Tasks</h2>
          <div class="task-history">
            {% for task in usertask %}
            {% if request.user.id == task.user.id %}
            <div class="task-history-item">
              <div class="task-history-details">
                <h3>{{task.task.title}}</h3>
                <p class="task-history-date">{{task.completed_at | timesince}}</p>
              </div>
              <div class="task-history-reward">&#8358;{{task.task.reward}}</div>
              <div>
                {% if task.status == "completed" %}
                <div class="task-history-status completed">{{task.status}}</div>
                {% elif task.status == "pending" %}
                <div class="task-history-status pending">{{task.status}}</div>
                {% else %}
                <div class="task-history-status completed">{{task.status}}</div>
                {% endif %}
              </div>
            </div>
            
            {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script src="js/profile.js"></script>
<script src="js/main.js"></script>
{% endblock content %}
